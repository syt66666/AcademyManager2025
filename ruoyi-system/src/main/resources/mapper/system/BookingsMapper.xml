<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ruoyi.system.mapper.BookingsMapper">
    <!-- 查询预约列表 -->
    <select id="selectBookingsList" parameterType="com.ruoyi.system.domain.Bookings" resultType="com.ruoyi.system.domain.Bookings">
        SELECT
        booking_id AS bookingId,
        student_id AS studentId,
        activity_id AS activityId,
        booked_at AS bookAt,
        proof,
        summary,
        status,
        reviewer,
        review_comment AS reviewComment,
        review_time AS reviewTime,
        create_by,
        create_time,
        update_by,
        update_time,
        remark
        FROM bookings
        <where>
            <if test="studentId != null">
                AND student_id = #{studentId}
            </if>
            <if test="activityId != null">
                AND activity_id = #{activityId}
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
        </where>
        ORDER BY booked_at DESC
    </select>

    <!-- 根据ID查询预约详情 -->
    <select id="selectBookingsById" parameterType="long" resultType="com.ruoyi.system.domain.Bookings">
        SELECT
        booking_id AS bookingId,
        student_id AS studentId,
        activity_id AS activityId,
        booked_at AS bookAt,
        proof,
        summary,
        status,
        reviewer,
        review_comment AS reviewComment,
        review_time AS reviewTime,
        create_by,
        create_time,
        update_by,
        update_time,
        remark
        FROM bookings
        WHERE booking_id = #{bookingId}
    </select>

    <!-- 新增预约 -->
    <insert id="insertBookings" parameterType="com.ruoyi.system.domain.Bookings">
        INSERT INTO bookings (
        student_id,
        activity_id,
        booked_at,
        proof,
        summary,
        status,
        reviewer,
        review_comment,
        review_time,
        create_by,
        create_time,
        update_by,
        update_time,
        remark
        ) VALUES (
        #{studentId},
        #{activityId},
        #{bookAt},
        #{proof},
        #{summary},
        #{status},
        #{reviewer},
        #{reviewComment},
        #{reviewTime},
        #{createBy},
        #{createTime},
        #{updateBy},
        #{updateTime},
        #{remark}
        )
    </insert>

    <!-- 修改预约 -->
    <update id="updateBookings" parameterType="com.ruoyi.system.domain.Bookings">
        UPDATE bookings
        SET
        student_id = #{studentId},
        activity_id = #{activityId},
        booked_at = #{bookAt},
        proof = #{proof},
        summary = #{summary},
        status = #{status},
        reviewer = #{reviewer},
        review_comment = #{reviewComment},
        review_time = #{reviewTime},
        update_by = #{updateBy},
        update_time = #{updateTime},
        remark = #{remark}
        WHERE booking_id = #{bookingId}
    </update>

    <!-- 批量删除预约 -->
    <delete id="deleteBookingsByIds" parameterType="long">
        DELETE FROM bookings
        WHERE booking_id IN
        <foreach collection="array" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
</mapper>